<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml" >

<head>
	<meta charset="UTF-8">
	<title>Agregar materia</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/solid.css">
	<script src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
	<link rel="stylesheet" type="text/css" href="static/css/main.css" th:href="@{/css/main.css}">
</head>

<body>
	<th:block th:include="/menucoordinador"></th:block>
	
	<div class="container">
		<div class="container row m-4 p-3">
			<div class="col"></div>
				<div class="col-8">
					<div:block th:each="e, row: ${expedientes}" class="flex mt-3 mb-3 m-2">
					<form class="form-inline center" th:action="@{/cursadas}" th:method="post">
						<input type="hidden" name="id" th:value="${e.codigo}" />
						<button type="submit" class="btn btn-primary form-control col-3 mr-2">Regresar</button>
					</form>
				</div:block>
				<div class="card text-white bg-dark col p-3 m-2">
					<h3 class="card-header"> EDITAR MATERIA </h3>
					<div class="card-body">
						<h1 th:text="${mensaje}"></h1>
						<form method="post" th:action="@{/editarExpedientemateria}" th:object="${alumnoxmateria}">
							<input type="hidden" th:field="${alumnoxmateria.c_alumnoxmateria}" th:value="${alumnoxmateria.c_alumnoxmateria}">
							<div class="input-group mb-2">
								<div class="input-group-prepend w-25">
									<div class="input-group-text">Materia</div>
								</div>
								<select class="form-control" th:field="${alumnoxmateria.materia.codigo}" id="selectMaterias">
									<option th:each="m: ${materias}" th:value="${m.codigo}" th:estado="${m.estado}">
										<th th:text="${m.nombreMateria}"></th>
									</option>
								</select>
							</div>
		
							<div class="input-group mb-2 hidden" >
								<div class="input-group-prepend w-25">
									<div class="input-group-text">Codigo</div>
								</div>
								<select th:field="${alumnoxmateria.expediente.codigo}">
									<option th:each="c: ${expedientes}" th:value="${c.codigo}">
										<th th:text="${c.codigo}"></th>
									</option>
								</select>
							</div>
		
							<div class="input-group mb-2">
								<div class="input-group-prepend w-25">
									<div class="input-group-text">Nota</div>
								</div>
								<input class="form-control" th:field="${alumnoxmateria.nota}" type="text" >
								<span th:errors="${alumnoxmateria.nota}" style="color:red;"></span>
							</div>
							<div class="input-group mb-2">
								<div class="input-group-prepend w-25">
									<div class="input-group-text">AÃ±o</div>
								</div>
								<input class="form-control" th:field="${alumnoxmateria.annio}" value="2005" type="number" >
								<span th:errors="${alumnoxmateria.annio}" style="color:red;"></span>
							</div>
							<div class="input-group mb-4">
								<div class="input-group-prepend w-25">
									<div class="input-group-text">Ciclo</div>
								</div>
								<select  class="form-control input-lg" name="ciclo">
									<option th:value="1" th:text="01"></option>
									<option th:value="2" th:text="02"></option>
									<option th:value="3" th:text="03"></option>
								</select>
							</div>
							<input type="submit" value="Guardar"  class="btn btn-danger form-control">
		
						</form> 
					</div>
				</div>
			</div>
			<div class="col"></div>
		</div>
	</div>
	<script type="text/javascript" th:inline="javascript">

		var materias = document.getElementById('selectMaterias');
		var materiasList = [];

		for(var i = 0; i<materias.childElementCount; i++){
			var listaAux = [];
			listaAux.push(materias.options[i].value);
			listaAux.push(materias.options[i].getAttribute("estado"));
			listaAux.push(materias.options[i].text);
			materiasList.push(listaAux);
		}

		var materiasFiltradas = listaFiltrada("Activa", materiasList);
		rebuildSelect(materiasFiltradas);

		function listaFiltrada (value, data){
			var filtraData = []
			for( var i = 0; i<data.length; i++){
				if(value == data[i][1]){
					filtraData.push(data[i]);
				}
			}
			return filtraData;
		}

		function rebuildSelect(data){
			var select = document.getElementById('selectMaterias');
			select.innerHTML= '';
			for( var i = 0; i<data.length; i++){
				var option = `
						<option  value="${data[i][0]}" estado="${data[i][1]}">${data[i][2]}</option>
				`
				select.innerHTML += option;
			}
		}

	</script>
</body>
</html>